.. _model_agent_fin:

=======================
金融模型智能体
=======================

**🤖 自动化量化交易与迭代模型演进**
------------------------------------------------------------------------------------------

📖 背景
~~~~~~~~~~~~~~
在量化金融领域，因子发现和模型开发在驱动性能方面都起着至关重要的作用。
虽然人们通常更关注新金融因子的发现，但利用这些因子的 **模型** 也同样重要。
量化策略的有效性不仅取决于所使用的因子，还取决于这些因子如何被很好地整合到稳健的预测模型中。

然而，开发和优化这些模型的过程可能既耗时又复杂，需要不断地改进和适应不断变化的市场条件。
这就是 **金融模型智能体** 发挥作用的地方。


🎥 `演示 <https://rdagent.azurewebsites.net/model_loop>`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

    <div style="display: flex; justify-content: center; align-items: center;">
      <video width="600" controls>
        <source src="https://rdagent.azurewebsites.net/media/d85e8cab1da1cd3501d69ce837452f53a971a24911eae7bfa9237137.mp4" type="video/mp4">
        您的浏览器不支持视频标签。
      </video>
    </div>


🌟 介绍
~~~~~~~~~~~~~~~~

在这个场景中，我们的自动化系统在一个持续的迭代过程中提出假设、构建模型、实现代码、进行回测并利用反馈。

目标是在 Qlib 库中自动优化性能指标，最终通过自主研发发现最高效的代码。

以下是步骤的增强大纲：

**步骤 1：假设生成 🔍**

- 基于先前的实验分析和领域专业知识，生成并提出初步假设，并附有详尽的推理和财务理由。

**步骤 2：模型创建 ✨**

- 将假设转化为任务。
- 开发、定义和实现一个量化模型，包括其名称、描述和公式。

**步骤 3：模型实现 👨‍💻**

- 根据详细描述实现模型代码。
- 像开发人员一样迭代地演进模型，确保准确性和效率。

**步骤 4：使用 Qlib 进行回测 📉**

- 使用新开发的模型和从 Alpha158 中提取的 20 个因子在 Qlib 中进行回测。
- 评估模型的有效性和性能。

+----------------+------------+------------------------+----------------------------------------------------+
| 数据集        | 模型      | 因子                | 数据拆分                                         |
+================+============+========================+====================================================+
| 沪深300         | RDAgent-dev| 20 个因子 (Alpha158)  | +-----------+--------------------------+           |
|                |            |                        | | 训练     | 2008-01-01 到 2014-12-31 |           |
|                |            |                        | +-----------+--------------------------+           |
|                |            |                        | | 验证     | 2015-01-01 到 2016-12-31 |           |
|                |            |                        | +-----------+--------------------------+           |
|                |            |                        | | 测试      | 2017-01-01 到 2020-08-01 |           |
|                |            |                        | +-----------+--------------------------+           |
+----------------+------------+------------------------+----------------------------------------------------+

**步骤 5：反馈分析 🔍**

- 分析回测结果以评估性能。
- 采纳反馈以完善假设并改进模型。

**步骤 6：假设完善 ♻️**

- 根据回测的反馈完善假设。
- 重复该过程以不断改进模型。

⚡ 快速开始
~~~~~~~~~~~~~~~~~

请参考 :doc:`../installation_and_configuration` 中的安装部分来准备您的系统依赖。

您可以通过运行以下命令来尝试我们的演示：

- 🐍 创建 Conda 环境

  - 使用 Python 创建一个新的 conda 环境（在我们的 CI 中，3.10 和 3.11 版本经过了充分测试）：

    .. code-block:: sh
    
        conda create -n rdagent python=3.10

  - 激活环境：

    .. code-block:: sh

        conda activate rdagent

- 📦 安装 RDAgent
    
  - 您可以从 PyPI 安装 RDAgent 包：

    .. code-block:: sh

        pip install rdagent

- 🚀 运行应用程序
    
  - 您可以通过使用以下命令直接运行应用程序：
    
    .. code-block:: sh

        rdagent fin_model

🛠️ 模块使用
~~~~~~~~~~~~~~~~~~~~~

.. _Env Config: 

- **环境配置**

可以在 `.env` 文件中设置以下环境变量来自定义应用程序的行为：

.. autopydantic_settings:: rdagent.app.qlib_rd_loop.conf.ModelBasePropSetting
    :settings-show-field-summary: False
    :exclude-members: Config

- **Qlib 配置**
    - `model_template` 文件夹中的 `config.yaml` 文件包含在 Qlib 中运行已开发模型的相关配置。默认设置包括以下关键信息：
        - **market**：指定市场，设置为 `csi300`。
        - **fields_group**：定义字段组，值为 `feature`。
        - **col_list**：使用的列列表，包括各种指标，如 `RESI5`、`WVMA5`、`RSQR5` 等。
        - **start_time**：数据的开始日期，设置为 `2008-01-01`。
        - **end_time**：数据的结束日期，设置为 `2020-08-01`。
        - **fit_start_time**：拟合模型的开始日期，设置为 `2008-01-01`。
        - **fit_end_time**：拟合模型的结束日期，设置为 `2014-12-31`。

    - 配置中使用的默认超参数如下：
        - **n_epochs**：时期数，设置为 `100`。
        - **lr**：学习率，设置为 `1e-3`。
        - **early_stop**：早停标准，设置为 `10`。
        - **batch_size**：批量大小，设置为 `2000`。
        - **metric**：评估指标，设置为 `loss`。
        - **loss**：损失函数，设置为 `mse`。
        - **n_jobs**：并行作业数，设置为 `20`。
