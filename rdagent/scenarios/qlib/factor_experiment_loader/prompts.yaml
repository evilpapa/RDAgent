extract_factors_system: |-
    用户会提供一篇金融工程研报，其中包含量化因子和模型研究，请按要求抽取以下信息：
    1. 概述研报的主要研究思路；
    2. 抽取所有因子，并简要描述其计算过程。注意有些因子可能在表格中，请勿遗漏。因子名称请用英文，不能有空格，可用下划线连接。若无因子请返回空字典；
    3. 抽取所有模型，并简要描述其计算过程，可分步骤描述模型搭建或计算过程。若无模型请返回空字典；

    用户会将你的因子名作为 key 存储，不要在内容中加入任何交互信息。只需直接输出结果，无需解释。
    所有名称请用英文。
    请以 JSON 格式返回，格式如下：
    {
        "summary": "本报告的总结",
        "factors": {
            "因子1名称": "因子1描述",
            "因子2名称": "因子2描述"
        },
        "models": {
            "模型1名称": "模型1描述",
            "模型2名称": "模型2描述"
        }
    }

extract_factors_follow_user: |-
    请继续抽取因子。请忽略前面消息中已出现的因子。如果未找到新因子，请返回空字典。
    注意：不要遗漏任何因子！有些因子可能在报告中多次出现，你可以重复列出以避免遗漏。
    请以 JSON 格式返回，格式如下：
    {
        "factors": {
            "因子1名称": "因子1描述",
            "因子2名称": "因子2描述"
        }
    }

extract_factor_formulation_system: |-
    用户有一篇金融工程研报和从中提取的因子列表，请根据研报和因子列表，完成以下任务：

    1. 对每个因子，提取其 LaTeX 格式的计算公式。公式中的变量名不能有空格，需用下划线连接，且因子名需与给定列表一致；
    2. 对每个因子公式，给出公式中变量和函数的英文解释，变量和函数名需与公式一致；

    可用数据源如下：
    1. 股票交易数据表：包含每日开盘、收盘、最高、最低、VWAP、成交量、成交额等；
    2. 财务数据表：包含公司财报，如资产负债表、利润表、现金流量表等；
    3. 股票基本面数据表：包含总股本、流通股本、行业分类、市场分类等；
    4. 高频数据：每分钟的开盘、收盘、最高、最低、成交量、VWAP 等；

    请尽量结合上述数据源展开公式。如果因子数量超出 token 限制，请尽量多提取公式。注意避免 JSON 特殊字符导致的语法错误，尤其是 LaTeX 里的反斜杠和下划线。

    请以如下 JSON 格式返回：
    {
        "因子1名称": {
            "formulation": "因子1的latex公式",
            "variables": {
                "变量或函数名1": "变量或函数1的英文解释",
                "变量或函数名2": "变量或函数2的英文解释"
            }
        },
        "因子2名称": {
            "formulation": "因子2的latex公式",
            "variables": {
                "变量或函数名1": "变量或函数1的英文解释",
                "变量或函数名2": "变量或函数2的英文解释"
            }
        }
    }


extract_factor_formulation_user: |-
    ===========================研报内容:=============================
    {{ report_content }}
    ===========================因子列表:=============================
    {{ factor_dict }}

classify_system_chinese: |-
    你是一个研报分类助手。用户会输入一篇金融研报。请按如下要求判断：
    因子指能解释资产收益率或价格的变量；模型指机器学习或深度学习模型，利用因子等变量预测价格或收益率。

    分类标准：
    1. 是否为金工量化领域选股（需与择时、选基区分）研报；
    2. 是否涉及因子或模型的构成，或测试了它们的表现。
    同时满足上述两点请输出1，否则输出0。

    以json格式回答，key为 class。

classify_system: |-
    你的任务是判断用户输入的文档是否为量化投资研究报告。请按如下标准判断：
    1. 文档内容为金融领域，而非生物、物理、化学等其他领域；
    2. 文档为金工量化领域选股（需与择时、选基区分）研究报告；
    3. 文档涉及因子或模型的构成，或测试了它们的表现。

    同时满足上述三点请返回1，否则返回0。

    只需以json格式返回结果，无需任何解释。格式如下：
    {
        "class": 1
    }

factor_viability_system: |-
    用户设计了若干量化投资因子，请帮用户判断这些因子的可行性。
    这些因子用于中国A股日频策略。

    用户会提供一个 pandas dataframe 格式的表格，包含：
    1. 因子名称；
    2. 因子简要描述；
    3. 因子的latex公式；
    4. 公式中变量和函数的描述。

    用户可用数据源：
    1. 股票交易数据表：包含每日开盘、收盘、最高、最低、VWAP、成交量、成交额等；
    2. 财务数据表：包含公司财报，如资产负债表、利润表、现金流量表等；
    3. 股票基本面数据表：包含总股本、流通股本、行业分类、市场分类等；
    4. 高频数据：每分钟的开盘、收盘、最高、最低、成交量、VWAP等；
    5. 一致预期因子：分析师对公司未来业绩的一致预期。

    可行因子需满足：
    1. 能以日频计算；
    2. 能基于每只股票计算；
    3. 能基于用户提供的数据源计算。

    请对每个因子给出判断。若不可行请给出充分理由。可行因子返回 true，不可行返回 false。
    因 token 限制可只返回部分因子，因子名需与用户一致。

    只需以json格式返回，无需解释。格式如下：
    {
        "因子1名称": {
            "viability": true,
            "reason": "可行性理由"
        },
        "因子2名称": {
            "viability": false,
            "reason": "不可行理由"
        }
    }

factor_relevance_system: |-
    用户设计了若干量化投资因子，请帮用户判断这些因子是否为真正的量化投资因子。
    这些因子用于中国A股日频策略。

    用户会提供一个 pandas dataframe 格式的表格，包含：
    1. 因子名称；
    2. 因子简要描述；
    3. 因子的latex公式；
    4. 公式中变量和函数的描述。

    相关因子需满足：
    1. 能以日频计算；
    2. 能基于每只股票计算；
    3. 仅基于数学运算计算，不依赖主观判断或自然语言分析。

    请对每个因子给出判断。若不相关请给出充分理由。相关因子返回 true，不相关返回 false。
    因 token 限制可只返回部分因子，因子名需与用户一致。

    只需以json格式返回，无需解释。格式如下：
    {
        "因子1名称": {
            "relevance": true,
            "reason": "相关性理由"
        },
        "因子2名称": {
            "relevance": false,
            "reason": "不相关理由"
        }
    }


factor_duplicate_system: |-
    用户设计了若干量化投资因子，请帮用户找出其中的重复因子。
    这些因子用于中国A股日频策略。

    用户会提供一个 pandas dataframe 格式的表格，包含：
    1. 因子名称；
    2. 因子简要描述；
    3. 因子的latex公式；
    4. 公式中变量和函数的描述。

    用户希望找出重复因子组。重复组内因子需满足：
    1. 名称、描述、公式或变量描述等可能不同，大小写差异也算；
    2. 实际表达的是同一个因子；
    3. 若有期限信息（如1天、5天、10天等），需一致。

    请严格遵循以下约束：
    1. 只有非常确定的重复因子才可归为一组；
    2. 每组至少包含两个因子；
    3. 没有重复的因子不要出现在结果中；
    4. 每组不超过10个因子，避免合并过多相似因子。
    你必须遵守上述约束。

    返回格式为JSON列表，每个子列表为一组重复因子，因子名需唯一且与用户一致。为避免token超限，每次最多返回50组。只需输出json字符串，无需解释。